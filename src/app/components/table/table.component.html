<ng-container
  *elderLet="{
    fields: model.columns$ | async,
    mobile: layoutService.mobile$ | async,
    filter: filterService.filter$ | async
  } as state"
>
  <div
    #elderTable
    id="elderTable"
    class="drug-table--wrapper"
    (keydown)="handleGridNavigation($event)"
  >
    <cdk-table
      matSort
      class="drug-table"
      [dataSource]="model"
      [fixedLayout]="true"
      [trackBy]="trackBy"
    >
      <!--Table headers-->
      <cdk-header-row
        class="row--header"
        *cdkHeaderRowDef="state.fields; sticky: true; index as i"
      ></cdk-header-row>

      <!--Group rows-->
      <cdk-row
        class="row--content"
        [class.is-expanded]="model.checkIsExpanded(row)"
        [class.is-group-row]="row.position.isGroup"
        *cdkRowDef="let row; columns: state.fields; when: rowShown(model)"
        (click)="model.toggle(row)"
        [detailPanel]="row"
        [detailPanelExpanded]="model.checkIsExpanded(row)"
      ></cdk-row>

      <ng-template cdkNoDataRow>
        <div
          style="
            display: flex;
            filter: grayscale(0.6);
            opacity: 0.5;
            align-items: center;
            flex-direction: column;
            padding: 1rem;
          "
        >
          <elder-brand [logoRem]="7" [showTitle]="false"></elder-brand>
        </div>
      </ng-template>

      <ng-container *ngFor="let field of state.fields; index as col" cdkColumnDef="{{ field }}">
        <ng-container *cdkHeaderCellDef>
          <cdk-header-cell
            class="header"
            mat-sort-header
            matTooltip="Sort by {{ field }}"
            [attr.tabIndex]="col === 0 ? '0' : '-1'"
            [keyGrid]="{ row: 0, col: this.col }"
          >
            <div class="header-content">
              {{ field | splitcase | titlecase }}
            </div>
          </cdk-header-cell>
        </ng-container>
        <ng-container *cdkCellDef="let row">
          <ng-container *ngIf="!row.position.isGroup; else groupTemplate">
            <div
              role="cell"
              class="cell-container"
              [class.is-icon-cell]="col === 0"
              [padLeft]="getPadding(row)"
              [padLeftIncrement]="7.5"
            >
              <button class="cell-chevron" *ngIf="col === 0">
                <svg class="cell-chevron-icon" viewBox="0 0 24 24">
                  <polygon points="8.1,3 6.9,4.1 14.8,12 6.9,19.9 8.1,21 17.1,12 8.1,3 " />
                </svg>
              </button>

              <div *ngIf="state.mobile" class="cell-title">
                {{ field | splitcase | titlecase }}
              </div>
              <div
                class="cell-content"
                [innerHtml]="row.fields[field] | toString | titlecase | highlight: state.filter"
              ></div>
            </div>
          </ng-container>
          <ng-template #groupTemplate>
            <elder-group-row
              #cell
              *ngIf="col === 0"
              [class.is-expanded]="model.checkIsExpanded(row)"
              [keyGrid]="{ row: 0, col: 0 }"
              [padLeft]="getPadding(row)"
            >
              <group-field>{{ row.field | splitcase }}</group-field>
              <group-name>{{ row.groupHeader | titlecase }}</group-name>
            </elder-group-row>
          </ng-template>
        </ng-container>
      </ng-container>
      <!--Header Row-->
    </cdk-table>
  </div>
</ng-container>
