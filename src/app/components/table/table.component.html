<!--<elder-column-selector
  *ngIf="tableName"
  (columnUpdates)="(dataSource.displayedHeaders | async) = $event"
  [tableName]="tableName"
  (loaded)="selectorInitiated = true"
></elder-column-selector>-->

<div class="root soft-shadow-2">
  <h2><ng-content select="elder-table-title"></ng-content></h2>

  <h3><ng-content select="elder-table-description"></ng-content></h3>

  <mat-divider></mat-divider>
  <div class="filter">
    <label class="filter__label"
      >Filter entries
      <input class="filter__input" (input)="filterData($event)" />
    </label>
  </div>
  <div class="filter">
    <label class="filter__label">Filter entries</label>
    <select class="filter__input" (input)="filterData($event)"></select>
  </div>

  <elder-column-selector></elder-column-selector>
  <cdk-table
    multiTemplateDataRows
    [dataSource]="dataSource"
    class="drug-table"
    matSort
    [fixedLayout]="true"
  >
    <cdk-header-row
      class="drug-table__header-row"
      *cdkHeaderRowDef="dataSource.displayedHeaders | async"
    ></cdk-header-row>

    <cdk-row
      *cdkRowDef="
        let row;
        columns: dataSource.displayedHeaders | async;
        when: isShown
      "
      class="drug-table__row"
    ></cdk-row>
    <cdk-row
      *cdkRowDef="let row; columns: ['groupHeader']; when: isGroup"
      (click)="toggleGroup(row.term)"
    ></cdk-row>
    <!--<tr
      cdk-row
      *cdkRowDef="let row; columns: ['mobileColumns']"
      class="mobile"
    ></tr>-->

    <ng-container
      *ngFor="
        let field of dataSource.displayedHeaders | async;
        trackBy: trackByFn
      "
      cdkColumnDef="{{ field }}"
    >
      <ng-container>
        <cdk-header-cell
          class="drug-table__header-cell"
          mat-sort-header
          *cdkHeaderCellDef
          matTooltip="Sort by {{ field }}"
        >
          <div style="min-width: 0">
            <div class="drug-table__header-cell__content">
              {{ field | caseSplit }}
            </div>
          </div>
        </cdk-header-cell></ng-container
      >
      <ng-container>
        <cdk-cell #cell class="cell" *cdkCellDef="let row">
          <!--If the cell is first, add an expansion button to it-->
          <span class="cell__chevron-container">
            <button
              *ngIf="field === (dataSource.displayedHeaders | async)[0]"
              class="chevron-button"
              mat-icon-button
            >
              <mat-icon
                [class.--rotated]="expandedElement"
                class="chevron-button__chevron"
                svgIcon="chevron_right"
              ></mat-icon></button
          ></span>
          <span role="columnheader" class="cell__mobile-header"
            ><b>{{ field }}</b></span
          >
          <span class="cell__content">{{ row[field] }}</span>
        </cdk-cell></ng-container
      >
    </ng-container>
    <ng-template cdkColumnDef="expandedDetail" *ngIf="selectedRow">
      <ng-container>
        <div *cdkCellDef="let row">
          <elder-expanded-element
            *ngIf="row === selectedRow"
            [expansionData]="row"
          ></elder-expanded-element>
        </div>
      </ng-container>

      <tr cdk-row *cdkRowDef="let row; columns: ['expandedDetail']"></tr>
    </ng-template>

    <ng-container cdkColumnDef="groupHeader">
      <cdk-header-cell
        class="drug-table__expand-row__cell"
        [attr.colspan]="(dataSource.displayedHeaders | async).length"
        *cdkCellDef="let row"
        [class.--open]="row.expanded"
      >
        <span class="hh-flex v-center-items">
          <mat-icon
            class="chevron"
            svgIcon="chevron_right"
            rotateIcon
            [class.--rotated]="row.expanded"
          ></mat-icon>

          <span class="drug-table__expand-row__cell__content">
            {{ groupProperty | caseSplit }}: {{ row.term | titlecase }}</span
          >
        </span>
      </cdk-header-cell>
    </ng-container>

    <!-- <ng-container cdkColumnDef="mobileColumns">
      <td
        class="drug-table__mobile-row hh-grid"
        cdk-cell
        *cdkCellDef="let row"
        [attr.colspan]="columnSpan"
      >
        <button
          class="drug-table__mobile-row__expand-button hh-span-1"
          mat-icon-button
        >
          <mat-icon
            [@rotateChevron]="row == expandedElement ? 'expanded' : 'collapsed'"
            class="drug-table__mobile-row__expand-button__chevron"
            style="will-change: transform"
            svgIcon="chevron_right"
          ></mat-icon>
        </button>
        <div class="hh-grid grid-spacing hh-span-11">
          <ng-container
            class="drug-table__mobile-cell"
            *ngFor="let field of dataSource.displayedHeaders | async"
          >
            <span class="drug-table__mobile-cell__title hh-span-4"
              ><b>{{ field | caseSplit }}</b></span
            >
            <span class="drug-table__mobile-cell__content hh-span-8">{{
              row[field]
            }}</span>
          </ng-container>
        </div>
      </td>
    </ng-container>-->
  </cdk-table>
</div>
