<form [formGroup]="drugsGroup">
  <section
    cdkScrollable
    aria-label="You can look up drugs on Beers Criteria using this form"
    class="form-container"
  >
    <div fxLayout="column" fxLayoutAlign="center center">
      <label
        class="form-field form-field__label"
        [class.flatbottom]="autocompleteElement.isOpen"
        (click)="MainInput.focus()"
        [class.lifted]="drugInput.dirty"
      >
        ADD DRUGS
        <div
          #origin="matAutocompleteOrigin"
          matAutocompleteOrigin
          class="form-field__container"
        >
          <input
            type="text"
            formControlName="drugInput"
            (keydown.Enter)="trigger.closePanel()"
            (input)="filterAutocomplete(MainInput.value)"
            class="form-field__container__input"
            aria-label="Enter your drug name here. For example, 'zolpidem'"
            #MainInput
            [matAutocomplete]="auto"
            [matAutocompleteConnectedTo]="origin"
            #trigger="matAutocompleteTrigger"
            placeholder="Zolpidem"
          />

          <button
            [disabled]="drugInput.valid"
            mat-icon-button
            class="add-button"
            [matTooltip]="
              drugInput.valid
                ? 'Add ' + MainInput.value
                : 'Choose a drug from the dropdown'
            "
            matTooltipPosition="above"
            matTooltipShowDelay="200"
            matTooltipHideDelay="200"
            matTooltipClass="form-field__tooltip form-field__tooltip--arrow-tip"
            (click)="addInput(); trigger.closePanel(); (stopPropagation)"
          >
            <mat-icon
              class="add-button__add-icon"
              inline="true"
              svgIcon="add--outline"
            ></mat-icon>
          </button>
        </div>
      </label>
      <div class="form-field__errors" id="errors">
        <span *ngIf="drugInput.errors?.required"> Name is required. </span>
        <span *ngIf="drugInput.errors?.minlength">
          Name must be at least 4 characters long.
        </span>
        <span *ngIf="drugInput.errors?.maxLength"> Name cannot be Bob. </span>
      </div>

      <div class="chip-list--container">
        <mat-list
          formArrayName="drugList"
          #chipList
          aria-label="Drug selection"
        >
          <div mat-subheader class="chip-list__title">SEARCH TERMS</div>

          <mat-list-item
            *ngFor="let drugName of drugList.controls; index as i"
            class="mat-standard-chip gray"
            [selectable]="selectable"
            [removable]="removable"
            matTooltip="Edit {{ drugName.value }}"
            matTooltipPosition="below"
            matTooltipShowDelay="200"
            matTooltipHideDelay="200"
            #chipTooltip="matTooltip"
            matTooltipClass="tooltip"
            tabIndex="-1"
          >
            <mat-icon
              mat-list-icon
              matTooltip="Remove {{ drugName.value }}"
              matTooltipPosition="below"
              matTooltipShowDelay="200"
              matTooltipClass="tooltip"
              (mouseover)="chipTooltip.disabled = true"
              (mouseleave)="chipTooltip.disabled = false; chipTooltip.show()"
              svgIcon="cancel"
              tabIndex="0"
              class="remove-icon"
              (click)="
                removeOptionAt(i); trigger.closePanel(); (stopPropagation)
              "
              (keydown.enter)="removeOptionAt(i)"
              *ngIf="removable"
            ></mat-icon>
            <span
              #origin="matAutocompleteOrigin"
              matAutocompleteOrigin
              class="editable-input"
              ><input
                style="grid-column: 1"
                [formControlName]="i"
                [matAutocomplete]="auto"
                #trigger="matAutocompleteTrigger"
                [matAutocompleteConnectedTo]="origin"
                #ListInput
                (keydown.enter)="(ListInput.blur)"
                (input)="filterAutocomplete(ListInput.value)"
              />
            </span>

            <mat-divider *ngIf="i != drugListLength - 1"></mat-divider>
          </mat-list-item>
        </mat-list>
        <mat-autocomplete
          #autocompleteElement
          autoActiveFirstOption
          #auto="matAutocomplete"
        >
          <mat-option
            #options
            [value]="option[0] + option[1]"
            *ngFor="let option of autocompleteObserver | async"
            (keydown.enter)="chooseOption(options.value)"
          >
            <span fxLayout="row" fxLayoutAlign="space-between">
              <span>
                <span style="font-weight: 500">{{ option[0] }}</span
                >{{ option[1] }}</span
              ><button
                mat-icon-button
                svgIcon="add--outline"
                (click)="chooseOption(options.value)"
              ></button
            ></span>
          </mat-option>
        </mat-autocomplete>
      </div>
    </div>
  </section>
</form>

<!--<button
            mat-icon-button
            (click)="removeOptionAt(i); trigger.closePanel(); stopPropagation()"
            (keydown.enter)="removeOptionAt(i)"
            *ngIf="i > 0"
          >
            <mat-icon
              class="remove icon-button"
              inline="true"
              svgIcon="delete"
            ></mat-icon>
          </button>-->
