<ng-container
  *elderLet="{
    mobile: layoutService.mobile$ | async,
    roundTabs: roundTabs$ | async,
    selectedTable: tableService.selection$ | async
  } as state"
>
  <ng-container *elderLet="sidebarState$ | async as sidebar"
    ><div class="layout">
      <div
        #header
        *ngIf="!sidebar.opened || !state.mobile"
        [class.is-mobile]="state.mobile"
        class="header"
      >
        <elder-toolbar [class.is-elevated]="state.roundTabs" class="toolbar" #toolbar>
          <toolbar-first-row class="toolbar-first-row">
            <elder-menu-toggle *ngIf="state.mobile" (toggle)="layoutService.toggleSidenav()">
              <mat-icon toggle-icon svgIcon="menu"></mat-icon>
            </elder-menu-toggle>
            <elder-brand
              elder-toolbar-brand
              logoSize="2.5rem"
              fontSize="2.3rem"
              [showTitle]="!state.mobile"
              orientation="column"
            ></elder-brand>
            <button class="toolbar-toggle" mat-icon-button>
              <mat-icon svgIcon="github"></mat-icon>
            </button>
          </toolbar-first-row>
          <toolbar-second-row class="toolbar-second-row">
            <elder-menu-toggle
              class="toolbar-small-toggle"
              *ngIf="!state.mobile"
              [toggled]="sidebar.opened"
              (toggle)="layoutService.toggleSidenav()"
            >
              <elder-animated-arrow toggle-icon></elder-animated-arrow>
            </elder-menu-toggle>
            <elder-tabs class="toolbar-tabs" [rounded]="state.roundTabs"> </elder-tabs>
          </toolbar-second-row>
        </elder-toolbar>
      </div>
      <main #main class="main">
        <section *ngIf="!sidebar.closed" class="sidebar-section">
          <elder-sidebar class="sidebar" #sidebar>
            <ng-template sidebar-toggle>
              <elder-menu-toggle toggle (toggle)="layoutService.toggleSidenav()">
                <mat-icon toggle-icon svgIcon="arrow_left"></mat-icon>
              </elder-menu-toggle>
            </ng-template>

            <ng-template sidebar-brand>
              <elder-brand brand orientation="row"></elder-brand>
            </ng-template>

            <elder-sidebar-legend *ngIf="!state.mobile">
              Search Beers Criteria
            </elder-sidebar-legend>
          </elder-sidebar>
        </section>
        <section #tableSection class="table-section" *ngIf="!(state.mobile && sidebar.opened)">
          <div #watchScroll class="rounded-tab-breakpoint"></div>
          <button
            style="
              position: fixed;
              right: 50px;
              top: 0px;
              z-index: 10000;
              padding: 5px;
              background: gray;
              color: white;
            "
            (click)="loadDemo()"
          >
            Demo
          </button>

          <elder-table-card
            class="table-card"
            [style.--table-card--opacity]="sidebar.opening ? 0 : 1"
            [icon]="state.selectedTable.tableIcon"
            *ngIf="searchStarted$ | async; else directions"
          >
            <elder-table-title>
              {{ state.selectedTable.shortName }}
            </elder-table-title>
            <elder-table-description>
              {{ state.selectedTable.description }}
            </elder-table-description>
            <elder-filter-bar>
              <elder-filter-input
                #tableFilter
                filter-search
                [hideLabel]="state.mobile"
              ></elder-filter-input>

              <elder-popup
                tooltipText="Show or hide columns"
                icon="fields"
                filter-field-popup
                #columnPopup
              >
                <popup-label>Fields</popup-label>
                <ng-template popup-content>
                  <elder-column-selector #columns></elder-column-selector> </ng-template
              ></elder-popup>
              <elder-popup
                tooltipText="Group by column"
                icon="group"
                filter-group-popup
                #groupPopup
              >
                <popup-label>Groups</popup-label>
                <ng-template popup-content>
                  <elder-group-by #groups></elder-group-by>
                </ng-template>
              </elder-popup>
            </elder-filter-bar>

            <elder-table
              #elderTable
              [filters]="tableFilter.filter | async"
              elderTableView
              elderResize
              class="elder-table"
            >
            </elder-table>
          </elder-table-card>
          <ng-template #directions>
            <elder-directions></elder-directions>
          </ng-template>
        </section>
      </main></div
  ></ng-container>
</ng-container>
