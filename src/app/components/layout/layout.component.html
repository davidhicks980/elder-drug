<ng-container
  *elderLet="{
    sidebar: {
      open: layoutService.openSidenav$ | async,
      animating: sidebarAnimatingSource | async
    },
    mobile: layoutService.mobile$ | async,
    roundTabs: roundTabs$ | async,
    selectedTable: tableService.selection$ | async
  } as state"
>
  <div class="layout" [class.hide-overflow]="state.sidebar.animating || state.sidebar.open">
    <div
      #header
      *ngIf="!state.sidebar.open || !state.mobile || state.sidebar.animating"
      [class.is-mobile]="state.mobile"
      [class.is-animating]="state.sidebar.animating"
      class="header"
    >
      <elder-toolbar #toolbar>
        <elder-menu-toggle
          elder-toolbar-toggle
          *ngIf="state.mobile"
          [toggled]="state.sidebar.open && !state.sidebar.animating"
          (toggle)="toggleSidenav()"
        >
          <elder-animated-arrow class="is-toggled" toggle-icon></elder-animated-arrow>
        </elder-menu-toggle>

        <nav
          elder-toolbar-tabs
          class="toolbar-tabs"
          [@FullSidebarShift]="getContentAnimationState(state)"
          [class.is-shifted]="state.sidebar.open"
          [class.is-animating]="state.sidebar.animating"
        >
          <elder-tabs [rounded]="state.roundTabs"> </elder-tabs>
        </nav>
        <elder-brand
          elder-toolbar-brand
          [logoRem]="3"
          [showTitle]="!state.mobile"
          [fontRem]="2.6"
          orientation="row"
        ></elder-brand>
        <button elder-toolbar-link class="toolbar-toggle" mat-icon-button>
          <mat-icon svgIcon="github"></mat-icon>
        </button>
      </elder-toolbar>
    </div>
    <main
      #main
      class="main"
      [class.is-sidebar-open]="state.sidebar.open"
      [class.is-animating]="state.sidebar.animating"
      [@FullSidebarShift]="getContentAnimationState(state)"
      (@FullSidebarShift.start)="changeAnimationState($event)"
      (@FullSidebarShift.done)="changeAnimationState($event)"
    >
      <section [class.click-through]="!state.sidebar.open" class="sidebar">
        <div class="sidebar-toggle" *ngIf="!state.mobile">
          <elder-menu-toggle toggle [toggled]="state.sidebar.open" (toggle)="toggleSidenav()">
            <elder-animated-arrow toggle-icon></elder-animated-arrow>
          </elder-menu-toggle>
        </div>

        <elder-sidebar *ngIf="state.sidebar.open || state.sidebar.animating" #sidebar>
          <ng-template sidebar-toggle>
            <elder-menu-toggle toggle [toggled]="state.sidebar.open" (toggle)="toggleSidenav()">
              <elder-animated-arrow toggle-icon></elder-animated-arrow>
            </elder-menu-toggle>
          </ng-template>

          <ng-template sidebar-brand>
            <elder-brand brand orientation="column"></elder-brand>
          </ng-template>

          <elder-sidebar-legend *ngIf="!state.mobile"> Search Beers Criteria </elder-sidebar-legend>
        </elder-sidebar>
      </section>
      <section
        #tableSection
        class="content"
        style="position: relative"
        *ngIf="!state.sidebar.open || !state.mobile"
      >
        <div
          #watchScroll
          style="position: absolute; height: 20px; top: 105px; width: 100%; pointer-events: none"
        ></div>
        <button
          style="
            position: fixed;
            right: 50px;
            top: 0px;
            z-index: 10000;
            padding: 5px;
            background: gray;
            color: white;
          "
          (click)="loadDemo()"
        >
          Demo
        </button>
        <elder-table-card [icon]="state.selectedTable.tableIcon" #table>
          <elder-table-title>
            {{ state.selectedTable.shortName }}
          </elder-table-title>
          <elder-table-description>
            {{ state.selectedTable.description }}
          </elder-table-description>
          <elder-filter-bar>
            <elder-filter-input
              #tableFilter
              filter-search
              [hideLabel]="state.mobile"
            ></elder-filter-input>

            <elder-popup
              tooltipText="Show or hide columns"
              icon="fields"
              filter-field-popup
              #columnPopup
            >
              <popup-label>Fields</popup-label>
              <ng-template popup-content>
                <elder-column-selector #columns></elder-column-selector> </ng-template
            ></elder-popup>
            <elder-popup tooltipText="Group by column" icon="group" filter-group-popup #groupPopup>
              <popup-label>Groups</popup-label>
              <ng-template popup-content>
                <elder-group-by #groups></elder-group-by>
              </ng-template>
            </elder-popup>
          </elder-filter-bar>

          <elder-table
            #elderTable
            [filters]="tableFilter.filter | async"
            elderTableView
            elderResize
            class="elder-table"
          >
          </elder-table>
        </elder-table-card>
      </section>
    </main>
  </div>
</ng-container>
