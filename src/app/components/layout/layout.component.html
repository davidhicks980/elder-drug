<ng-container
  *elderLet="{
    sidebarOpen: sidebarOpen$ | async,
    mobile: resizeService.mobile$ | async,
    animating: animating$ | async,
    roundTabs: roundTabs$ | async,
    selectedTable: selectedTable$ | async
  } as state"
>
  <div class="layout" [class.hide-overflow]="state.animating.sidebar || state.sidebarOpen">
    <div
      *ngIf="!state.sidebarOpen || !state.mobile || state.animating.sidebar"
      [class.is-mobile]="state.mobile"
      [class.is-animating]="state.animating.sidebar"
      class="layout__header"
    >
      <elder-toolbar #toolbar>
        <elder-menu-toggle
          elder-toolbar-toggle
          *ngIf="state.mobile"
          [toggled]="state.sidebarOpen && !state.animating.sidebar"
          (toggle)="toggleSidenav()"
        >
          <elder-animated-arrow class="is-toggled" toggle-icon></elder-animated-arrow>
        </elder-menu-toggle>

        <nav
          elder-toolbar-tabs
          class="toolbar-tabs"
          [class.is-shifted]="state.sidebarOpen"
          [@FullSidebarShift]="getContentAnimationState(state)"
          [class.is-animating]="state.animating.sidebar"
        >
          <elder-tabs [rounded]="state.roundTabs && state.mobile"> </elder-tabs>
        </nav>
        <elder-brand
          elder-toolbar-brand
          [logoRem]="3"
          [showTitle]="!state.mobile"
          [fontRem]="2.6"
          orientation="row"
        ></elder-brand>
        <button elder-toolbar-link class="toolbar-toggle" mat-icon-button>
          <mat-icon svgIcon="github"></mat-icon>
        </button>
      </elder-toolbar>
    </div>
    <main
      class="layout__main"
      [class.is-sidebar-open]="state.sidebarOpen"
      [class.is-animating]="state.animating.sidebar"
      [@FullSidebarShift]="getContentAnimationState(state)"
      (@FullSidebarShift.start)="changeAnimationState($event, 'sidebar')"
      (@FullSidebarShift.done)="changeAnimationState($event, 'sidebar')"
    >
      <section [class.click-through]="!state.sidebarOpen" class="main__sidebar">
        <div
          (click)="changeToggleState(state.sidebarOpen)"
          class="main__sidebar__toggle"
          *ngIf="!state.mobile"
        >
          <elder-menu-toggle toggle [toggled]="state.sidebarOpen" (toggle)="toggleSidenav()">
            <elder-animated-arrow toggle-icon></elder-animated-arrow>
          </elder-menu-toggle>
        </div>

        <elder-sidebar *ngIf="state.sidebarOpen || state.animating.sidebar" #sidebar>
          <ng-template sidebar-toggle>
            <elder-menu-toggle toggle [toggled]="state.sidebarOpen" (toggle)="toggleSidenav()">
              <elder-animated-arrow toggle-icon></elder-animated-arrow>
            </elder-menu-toggle>
          </ng-template>

          <ng-template sidebar-brand>
            <elder-brand brand orientation="column"></elder-brand>
          </ng-template>

          <elder-sidebar-legend *ngIf="!state.mobile"> Search Beers Criteria </elder-sidebar-legend>
        </elder-sidebar>
      </section>
      <section #mainWrapper class="main__content" *ngIf="!state.sidebarOpen || !state.mobile">
        <button (click)="loadDemo()">Demo</button>
        <elder-table-card #table>
          <elder-table-title>
            {{ state.selectedTable.shortName }}
          </elder-table-title>
          <elder-table-description>
            {{ state.selectedTable.description }}
          </elder-table-description>
          <elder-filter-bar>
            <elder-filter-input #tableFilter filter-search></elder-filter-input>

            <elder-popup filter-field-popup #columnPopup>
              <popup-label>Fields</popup-label>
              <popup-placeholder [placeholderList]="table.columns | async"></popup-placeholder>
              <ng-template popup-content>
                <elder-column-selector #columns></elder-column-selector> </ng-template
            ></elder-popup>
            <elder-popup filter-group-popup #groupPopup>
              <popup-label>Groups</popup-label>
              <popup-placeholder [placeholderList]="table.groups | async"></popup-placeholder>
              <ng-template popup-content>
                <elder-group-by #groups></elder-group-by>
              </ng-template>
            </elder-popup>
          </elder-filter-bar>

          <elder-table
            [filters]="tableFilter.filter | async"
            elderTableView
            elderResize
            class="elder-table"
          >
          </elder-table>
        </elder-table-card>
      </section>
    </main>
  </div>
</ng-container>
